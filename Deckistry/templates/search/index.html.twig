{% extends 'base.html.twig' %}

{% block title %}Recherche de cartes - Deckistry{% endblock %}

{% block importmap %}
    {{ parent() }}
    {{ importmap('search') }}
{% endblock %}

{% block body %}
<div class="search-page">
    <div class="container">
        <div class="search-layout">
            {# Left Sidebar - Advanced Filters #}
            <aside class="search-filters">
                <h2 class="filters-title">üîç Recherche</h2>
                
                <form method="get" action="{{ path('app_search') }}" class="search-form">
                    <div class="search-input-section">
                        <input 
                            type="text" 
                            name="q" 
                            value="{{ query }}" 
                            placeholder="Super carte"
                            class="filter-input"
                            autocomplete="off"
                            id="searchInput"
                            data-autocomplete-url="{{ path('api_cards_autocomplete') }}"
                        >
                        <div id="searchSuggestions" class="search-suggestions"></div>
                        <button type="submit" class="btn btn-accent btn-search">Rechercher</button>
                    </div>

                {# Advanced Filters Section #}
                <div class="filter-section">
                    <h3 class="filter-section-title">
                        <button type="button" class="filter-toggle active" data-target="advanced-filters">
                            <span>‚ñº</span> Recherche avanc√©es
                        </button>
                    </h3>
                    <div class="filter-content active" id="advanced-filters">
                        {# Mana Colors #}
                        <div class="filter-group">
                            <label class="filter-label">Couleurs de mana</label>
                            <div class="logic-selector">
                                <label class="logic-option">
                                    <input type="radio" name="logic" value="or" checked>
                                    <span>Ou</span>
                                </label>
                                <label class="logic-option">
                                    <input type="radio" name="logic" value="and">
                                    <span>Inclue</span>
                                </label>
                            </div>
                            <div class="mana-colors">
                                <button type="button" class="mana-btn" data-color="C" title="Incolore">
                                    <img src="{{ asset('icons/unncolor.webp') }}" alt="Incolore" class="mana-icon">
                                </button>
                                <button type="button" class="mana-btn" data-color="W" title="Blanc">
                                    <img src="{{ asset('icons/plain.webp') }}" alt="Blanc" class="mana-icon">
                                </button>
                                <button type="button" class="mana-btn" data-color="U" title="Bleu">
                                    <img src="{{ asset('icons/Island.webp') }}" alt="Bleu" class="mana-icon">
                                </button>
                                <button type="button" class="mana-btn" data-color="B" title="Noir">
                                    <img src="{{ asset('icons/Swamp.webp') }}" alt="Noir" class="mana-icon">
                                </button>
                                <button type="button" class="mana-btn" data-color="R" title="Rouge">
                                    <img src="{{ asset('icons/Mountain.webp') }}" alt="Rouge" class="mana-icon">
                                </button>
                                <button type="button" class="mana-btn" data-color="G" title="Vert">
                                    <img src="{{ asset('icons/Forest.webp') }}" alt="Vert" class="mana-icon">
                                </button>
                                <button type="button" class="mana-btn" data-color="M" title="Multicolore">
                                    <img src="{{ asset('icons/icone_Timeshifted.webp') }}" alt="Multicolore" class="mana-icon">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                {# Editions Filter #}
                <div class="filter-section">
                    <h3 class="filter-section-title">
                        <button type="button" class="filter-toggle" data-target="editions-filter">
                            <span>‚ñ∂</span> √âditions
                        </button>
                    </h3>
                    <div class="filter-content" id="editions-filter">
                        <select name="set" class="filter-select">
                            <option value="">Toutes les √©ditions</option>
                            {% for set in sets %}
                                <option value="{{ set.code }}">{{ set.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                {# Rarity Filter #}
                <div class="filter-section">
                    <h3 class="filter-section-title">
                        <button type="button" class="filter-toggle active" data-target="rarity-filter">
                            <span>‚ñº</span> Raret√©
                        </button>
                    </h3>
                    <div class="filter-content active" id="rarity-filter">
                        <div class="rarity-options">
                            <label class="rarity-option">
                                <input type="checkbox" name="rarity[]" value="common">
                                <img src="{{ asset('icons/iconne_commune.webp') }}" alt="Commune" class="rarity-icon">
                                <span class="rarity-common">Commune</span>
                            </label>
                            <label class="rarity-option">
                                <input type="checkbox" name="rarity[]" value="uncommon">
                                <img src="{{ asset('icons/icone_unnco.webp') }}" alt="Peu commune" class="rarity-icon">
                                <span class="rarity-uncommon">Peu commune</span>
                            </label>
                            <label class="rarity-option">
                                <input type="checkbox" name="rarity[]" value="rare">
                                <img src="{{ asset('icons/icone_rare.webp') }}" alt="Rare" class="rarity-icon">
                                <span class="rarity-rare">Rare</span>
                            </label>
                            <label class="rarity-option">
                                <input type="checkbox" name="rarity[]" value="mythic">
                                <img src="{{ asset('icons/icone_mithyque.webp') }}" alt="Mythique" class="rarity-icon">
                                <span class="rarity-mythic">Mythique</span>
                            </label>
                        </div>
                    </div>
                </div>

                {# Card Type Filter #}
                <div class="filter-section">
                    <h3 class="filter-section-title">
                        <button type="button" class="filter-toggle active" data-target="type-filter">
                            <span>‚ñº</span> Type de cartes (ex: Cr√©ature)
                        </button>
                    </h3>
                    <div class="filter-content active" id="type-filter">
                        <div class="type-options">
                            <label class="type-option">
                                <input type="checkbox" name="type[]" value="creature">
                                <span>Cr√©ature</span>
                            </label>
                            <label class="type-option">
                                <input type="checkbox" name="type[]" value="planeswalker">
                                <span>Planeswalker</span>
                            </label>
                            <label class="type-option">
                                <input type="checkbox" name="type[]" value="instant">
                                <span>√âph√©m√®re</span>
                            </label>
                            <label class="type-option">
                                <input type="checkbox" name="type[]" value="sorcery">
                                <span>Rituel</span>
                            </label>
                            <label class="type-option">
                                <input type="checkbox" name="type[]" value="artifact">
                                <span>Artefact</span>
                            </label>
                            <label class="type-option">
                                <input type="checkbox" name="type[]" value="enchantment">
                                <span>Enchantement</span>
                            </label>
                            <label class="type-option">
                                <input type="checkbox" name="type[]" value="land">
                                <span>Terrain</span>
                            </label>
                        </div>
                    </div>
                </div>
                </form>
            </aside>

            {# Main Content Area #}
            <main class="search-content">
                {# Error Message #}
                {% if error %}
                    <div class="alert alert-danger">
                        {{ error }}
                    </div>
                {% endif %}

                {# Results Section #}
                {% if query or cards|length > 0 %}
                    {# Results Header #}
                    <div class="results-header">
                        <h2 class="results-title">
                            {% if cards|length > 0 %}
                                {{ total_cards }} carte(s) trouv√©e(s)
                            {% else %}
                                Aucune carte trouv√©e
                            {% endif %}
                        </h2>
                        
                        {% if cards|length > 0 %}
                            <div class="results-controls">
                                <select class="sort-select">
                                    <option value="name">Tri par nom</option>
                                    <option value="cmc">Tri par co√ªt</option>
                                    <option value="rarity">Tri par raret√©</option>
                                    <option value="price">Tri par prix</option>
                                </select>
                            </div>
                        {% endif %}
                    </div>

                    {# Cards Grid #}
                    {% if cards|length > 0 %}
                        <div class="cards-grid">
                            {% for card in cards %}
                                <div class="card-item">
                                    <div class="card-image-wrapper">
                                        {% if card.getBestImageUri() %}
                                            <img 
                                                src="{{ card.getBestImageUri() }}" 
                                                alt="{{ card.name }}"
                                                class="card-image"
                                                loading="lazy"
                                            >
                                        {% else %}
                                            <div class="card-placeholder">
                                                <span>Pas d'image</span>
                                            </div>
                                        {% endif %}
                                        
                                        <div class="card-overlay">
                                            <button class="btn btn-primary btn-sm" onclick="addToCollection('{{ card.id }}')">
                                                + Collection
                                            </button>
                                            <a href="{{ card.scryfallUri }}" target="_blank" class="btn btn-secondary btn-sm">
                                                Scryfall
                                            </a>
                                        </div>
                                    </div>
                                    
                                    <div class="card-info">
                                        <h3 class="card-name">{{ card.name }}</h3>
                                        
                                        {% if card.manaCost %}
                                            <div class="card-mana">{{ card.manaCost|mana_symbols }}</div>
                                        {% endif %}
                                        
                                        <p class="card-type">{{ card.typeLine }}</p>
                                        
                                        {% if card.getStats() %}
                                            <p class="card-stats">{{ card.getStats() }}</p>
                                        {% endif %}
                                        
                                        <div class="card-set">
                                            {{ card.setCode|upper }}
                                        </div>
                                        
                                        {% if card.eurPrice %}
                                            <div class="card-price">‚Ç¨{{ card.eurPrice }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        {# Pagination #}
                        <div class="pagination">
                            {% if current_page > 1 %}
                                <a href="{{ path('app_search', {q: query, page: current_page - 1}) }}" class="pagination-btn">
                                    ‚Üê Pr√©c√©dent
                                </a>
                            {% endif %}
                            
                            <span class="pagination-current">Page {{ current_page }}</span>
                            
                            {% if has_more %}
                                <a href="{{ path('app_search', {q: query, page: current_page + 1}) }}" class="pagination-btn">
                                    Suivant ‚Üí
                                </a>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="no-results">
                            <div class="no-results-icon">üîç</div>
                            <h3>Aucune carte trouv√©e</h3>
                            <p>Essayez avec d'autres termes de recherche ou filtres</p>
                        </div>
                    {% endif %}
                {% else %}
                    {# Empty state #}
                    <div class="search-empty">
                        <div class="empty-icon">üé¥</div>
                        <h2>Recherchez des cartes Magic</h2>
                        <p>Utilisez les filtres √† gauche ou la barre de recherche pour trouver vos cartes</p>
                        
                        <div class="quick-searches">
                            <h3>Recherches populaires :</h3>
                            <div class="quick-search-grid">
                                <a href="{{ path('app_search', {q: 'lightning bolt'}) }}" class="quick-search-item">
                                    ‚ö° Lightning Bolt
                                </a>
                                <a href="{{ path('app_search', {q: 't:creature c:red'}) }}" class="quick-search-item">
                                    üî• Cr√©atures rouges
                                </a>
                                <a href="{{ path('app_search', {q: 't:planeswalker'}) }}" class="quick-search-item">
                                    üëë Planeswalkers
                                </a>
                                <a href="{{ path('app_search', {q: 't:legendary'}) }}" class="quick-search-item">
                                    ‚≠ê L√©gendaires
                                </a>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </main>
        </div>
    </div>
</div>
{% endblock %}
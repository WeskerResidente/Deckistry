#!/usr/bin/env php
<?php

use App\Service\ScryfallService;
use Symfony\Component\Dotenv\Dotenv;

require dirname(__DIR__).'/vendor/autoload.php';

(new Dotenv())->bootEnv(dirname(__DIR__).'/.env');

$kernel = new \App\Kernel($_SERVER['APP_ENV'], (bool) $_SERVER['APP_DEBUG']);
$kernel->boot();
$container = $kernel->getContainer();

/** @var ScryfallService $scryfallService */
$scryfallService = $container->get(ScryfallService::class);

echo "ðŸƒ Testing Scryfall API Integration\n";
echo "====================================\n\n";

// Test 1: Get a card by ID
echo "1ï¸âƒ£  Testing getCardById()...\n";
try {
    $card = $scryfallService->getCardById('f0e42b92-6708-4e3c-b765-8cbb1d6d59da');
    echo "   âœ… Success! Found: {$card->name}\n";
    echo "   Type: {$card->typeLine}\n";
    echo "   Mana Cost: {$card->manaCost}\n";
    echo "   Set: {$card->setName} ({$card->setCode})\n\n";
} catch (\Exception $e) {
    echo "   âŒ Error: {$e->getMessage()}\n\n";
}

// Test 2: Search for cards
echo "2ï¸âƒ£  Testing searchCards()...\n";
try {
    $result = $scryfallService->searchCards('lightning bolt');
    echo "   âœ… Success! Found {$result['total_cards']} cards\n";
    echo "   Showing first 3:\n";
    foreach (array_slice($result['data'], 0, 3) as $card) {
        echo "   - {$card->name} ({$card->setCode})\n";
    }
    echo "\n";
} catch (\Exception $e) {
    echo "   âŒ Error: {$e->getMessage()}\n\n";
}

// Test 3: Autocomplete
echo "3ï¸âƒ£  Testing autocomplete()...\n";
try {
    $suggestions = $scryfallService->autocomplete('light');
    echo "   âœ… Success! Found " . count($suggestions) . " suggestions\n";
    echo "   First 5: " . implode(', ', array_slice($suggestions, 0, 5)) . "\n\n";
} catch (\Exception $e) {
    echo "   âŒ Error: {$e->getMessage()}\n\n";
}

// Test 4: Get card by name
echo "4ï¸âƒ£  Testing getCardByName()...\n";
try {
    $card = $scryfallService->getCardByName('Black Lotus');
    echo "   âœ… Success! Found: {$card->name}\n";
    echo "   Set: {$card->setName}\n";
    if ($card->usdPrice) {
        echo "   Price: \${$card->usdPrice}\n";
    }
    echo "\n";
} catch (\Exception $e) {
    echo "   âŒ Error: {$e->getMessage()}\n\n";
}

// Test 5: Random card
echo "5ï¸âƒ£  Testing getRandomCard()...\n";
try {
    $card = $scryfallService->getRandomCard();
    echo "   âœ… Success! Random card: {$card->name}\n";
    echo "   Type: {$card->typeLine}\n\n";
} catch (\Exception $e) {
    echo "   âŒ Error: {$e->getMessage()}\n\n";
}

echo "====================================\n";
echo "âœ… All tests completed!\n";
echo "\nYou can now use ScryfallService in your controllers.\n";
echo "Check SCRYFALL_GUIDE.md for usage examples.\n";
